var Nt=Object.defineProperty;var xt=(s,t,e)=>t in s?Nt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>xt(s,typeof t!="symbol"?t+"":t,e);import{E as f,L as x,Q as O}from"./index-y7ty4Tjl.js";async function Ot(s,t=3,e=1e3){let i=1;for(;i<=t;)try{return await s()}catch(n){if(i++,i>t)throw new Error(n instanceof Error?n.message:`Failed to perform action after ${t} attempts`);await new Promise(r=>setTimeout(r,e))}throw new Error("Unreachable code")}const b=Object.create(null);b.open="0";b.close="1";b.ping="2";b.pong="3";b.message="4";b.upgrade="5";b.noop="6";const U=Object.create(null);Object.keys(b).forEach(s=>{U[b[s]]=s});const z={type:"error",data:"parser error"},pt=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",mt=typeof ArrayBuffer=="function",gt=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,G=({type:s,data:t},e,i)=>pt&&t instanceof Blob?e?i(t):at(t,i):mt&&(t instanceof ArrayBuffer||gt(t))?e?i(t):at(new Blob([t]),i):i(b[s]+(t||"")),at=(s,t)=>{const e=new FileReader;return e.onload=function(){const i=e.result.split(",")[1];t("b"+(i||""))},e.readAsDataURL(s)};function ct(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let $;function Mt(s,t){if(pt&&s.data instanceof Blob)return s.data.arrayBuffer().then(ct).then(t);if(mt&&(s.data instanceof ArrayBuffer||gt(s.data)))return t(ct(s.data));G(s,!1,e=>{$||($=new TextEncoder),t($.encode(e))})}const ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<ht.length;s++)A[ht.charCodeAt(s)]=s;const It=s=>{let t=s.length*.75,e=s.length,i,n=0,r,o,a,c;s[s.length-1]==="="&&(t--,s[s.length-2]==="="&&t--);const p=new ArrayBuffer(t),u=new Uint8Array(p);for(i=0;i<e;i+=4)r=A[s.charCodeAt(i)],o=A[s.charCodeAt(i+1)],a=A[s.charCodeAt(i+2)],c=A[s.charCodeAt(i+3)],u[n++]=r<<2|o>>4,u[n++]=(o&15)<<4|a>>2,u[n++]=(a&3)<<6|c&63;return p},Bt=typeof ArrayBuffer=="function",Q=(s,t)=>{if(typeof s!="string")return{type:"message",data:yt(s,t)};const e=s.charAt(0);return e==="b"?{type:"message",data:Ut(s.substring(1),t)}:U[e]?s.length>1?{type:U[e],data:s.substring(1)}:{type:U[e]}:z},Ut=(s,t)=>{if(Bt){const e=It(s);return yt(e,t)}else return{base64:!0,data:s}},yt=(s,t)=>{switch(t){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},_t="",Pt=(s,t)=>{const e=s.length,i=new Array(e);let n=0;s.forEach((r,o)=>{G(r,!1,a=>{i[o]=a,++n===e&&t(i.join(_t))})})},Dt=(s,t)=>{const e=s.split(_t),i=[];for(let n=0;n<e.length;n++){const r=Q(e[n],t);if(i.push(r),r.type==="error")break}return i};function qt(){return new TransformStream({transform(s,t){Mt(s,e=>{const i=e.length;let n;if(i<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,i);else if(i<65536){n=new Uint8Array(3);const r=new DataView(n.buffer);r.setUint8(0,126),r.setUint16(1,i)}else{n=new Uint8Array(9);const r=new DataView(n.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(i))}s.data&&typeof s.data!="string"&&(n[0]|=128),t.enqueue(n),t.enqueue(e)})}})}let V;function M(s){return s.reduce((t,e)=>t+e.length,0)}function I(s,t){if(s[0].length===t)return s.shift();const e=new Uint8Array(t);let i=0;for(let n=0;n<t;n++)e[n]=s[0][i++],i===s[0].length&&(s.shift(),i=0);return s.length&&i<s[0].length&&(s[0]=s[0].slice(i)),e}function Ft(s,t){V||(V=new TextDecoder);const e=[];let i=0,n=-1,r=!1;return new TransformStream({transform(o,a){for(e.push(o);;){if(i===0){if(M(e)<1)break;const c=I(e,1);r=(c[0]&128)===128,n=c[0]&127,n<126?i=3:n===126?i=1:i=2}else if(i===1){if(M(e)<2)break;const c=I(e,2);n=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(M(e)<8)break;const c=I(e,8),p=new DataView(c.buffer,c.byteOffset,c.length),u=p.getUint32(0);if(u>Math.pow(2,21)-1){a.enqueue(z);break}n=u*Math.pow(2,32)+p.getUint32(4),i=3}else{if(M(e)<n)break;const c=I(e,n);a.enqueue(Q(r?c:V.decode(c),t)),i=0}if(n===0||n>s){a.enqueue(z);break}}}})}const vt=4;function l(s){if(s)return Ht(s)}function Ht(s){for(var t in l.prototype)s[t]=l.prototype[t];return s}l.prototype.on=l.prototype.addEventListener=function(s,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(t),this};l.prototype.once=function(s,t){function e(){this.off(s,e),t.apply(this,arguments)}return e.fn=t,this.on(s,e),this};l.prototype.off=l.prototype.removeListener=l.prototype.removeAllListeners=l.prototype.removeEventListener=function(s,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+s];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var i,n=0;n<e.length;n++)if(i=e[n],i===t||i.fn===t){e.splice(n,1);break}return e.length===0&&delete this._callbacks["$"+s],this};l.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+s],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(e){e=e.slice(0);for(var i=0,n=e.length;i<n;++i)e[i].apply(this,t)}return this};l.prototype.emitReserved=l.prototype.emit;l.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};l.prototype.hasListeners=function(s){return!!this.listeners(s).length};const F=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),y=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),$t="arraybuffer";function bt(s,...t){return t.reduce((e,i)=>(s.hasOwnProperty(i)&&(e[i]=s[i]),e),{})}const Vt=y.setTimeout,Wt=y.clearTimeout;function H(s,t){t.useNativeTimers?(s.setTimeoutFn=Vt.bind(y),s.clearTimeoutFn=Wt.bind(y)):(s.setTimeoutFn=y.setTimeout.bind(y),s.clearTimeoutFn=y.clearTimeout.bind(y))}const zt=1.33;function jt(s){return typeof s=="string"?Yt(s):Math.ceil((s.byteLength||s.size)*zt)}function Yt(s){let t=0,e=0;for(let i=0,n=s.length;i<n;i++)t=s.charCodeAt(i),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(i++,e+=4);return e}function wt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Jt(s){let t="";for(let e in s)s.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(s[e]));return t}function Kt(s){let t={},e=s.split("&");for(let i=0,n=e.length;i<n;i++){let r=e[i].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}class Xt extends Error{constructor(t,e,i){super(t),this.description=e,this.context=i,this.type="TransportError"}}class Z extends l{constructor(t){super(),this.writable=!1,H(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,i){return super.emitReserved("error",new Xt(t,e,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Q(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const e=Jt(t);return e.length?"?"+e:""}}class Gt extends Z{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||e()})),this.writable||(i++,this.once("drain",function(){--i||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Dt(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Pt(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=wt()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}}let Et=!1;try{Et=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Qt=Et;function Zt(){}class te extends Gt{constructor(t){if(super(t),typeof location<"u"){const e=location.protocol==="https:";let i=location.port;i||(i=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}}doWrite(t,e){const i=this.request({method:"POST",data:t});i.on("success",e),i.on("error",(n,r)=>{this.onError("xhr post error",n,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,i)=>{this.onError("xhr poll error",e,i)}),this.pollXhr=t}}class v extends l{constructor(t,e,i){super(),this.createRequest=t,H(this,i),this._opts=i,this._method=i.method||"GET",this._uri=e,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var t;const e=bt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(e);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&i.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var n;i.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=v.requestsCount++,v.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Zt,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete v.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}v.requestsCount=0;v.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",dt);else if(typeof addEventListener=="function"){const s="onpagehide"in y?"pagehide":"unload";addEventListener(s,dt,!1)}}function dt(){for(let s in v.requests)v.requests.hasOwnProperty(s)&&v.requests[s].abort()}const ee=function(){const s=Ct({xdomain:!1});return s&&s.responseType!==null}();class ie extends te{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=ee&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new v(Ct,this.uri(),t)}}function Ct(s){const t=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Qt))return new XMLHttpRequest}catch{}if(!t)try{return new y[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const kt=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class se extends Z{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,i=kt?{}:bt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,i)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=t[e],n=e===t.length-1;G(i,this.supportsBinary,r=>{try{this.doWrite(i,r)}catch{}n&&F(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=wt()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}const W=y.WebSocket||y.MozWebSocket;class ne extends se{createSocket(t,e,i){return kt?new W(t,e,i):e?new W(t,e):new W(t)}doWrite(t,e){this.ws.send(e)}}class re extends Z{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const e=Ft(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=t.readable.pipeThrough(e).getReader(),n=qt();n.readable.pipeTo(t.writable),this._writer=n.writable.getWriter();const r=()=>{i.read().then(({done:a,value:c})=>{a||(this.onPacket(c),r())}).catch(a=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=t[e],n=e===t.length-1;this._writer.write(i).then(()=>{n&&F(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const oe={websocket:ne,webtransport:re,polling:ie},ae=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ce=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function j(s){if(s.length>8e3)throw"URI too long";const t=s,e=s.indexOf("["),i=s.indexOf("]");e!=-1&&i!=-1&&(s=s.substring(0,e)+s.substring(e,i).replace(/:/g,";")+s.substring(i,s.length));let n=ae.exec(s||""),r={},o=14;for(;o--;)r[ce[o]]=n[o]||"";return e!=-1&&i!=-1&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=he(r,r.path),r.queryKey=de(r,r.query),r}function he(s,t){const e=/\/{2,9}/g,i=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function de(s,t){const e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,n,r){n&&(e[n]=r)}),e}const Y=typeof addEventListener=="function"&&typeof removeEventListener=="function",P=[];Y&&addEventListener("offline",()=>{P.forEach(s=>s())},!1);class E extends l{constructor(t,e){if(super(),this.binaryType=$t,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(e=t,t=null),t){const i=j(t);e.hostname=i.host,e.secure=i.protocol==="https"||i.protocol==="wss",e.port=i.port,i.query&&(e.query=i.query)}else e.host&&(e.hostname=j(e.host).host);H(this,e),this.secure=e.secure!=null?e.secure:typeof location<"u"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach(i=>{const n=i.prototype.name;this.transports.push(n),this._transportsByName[n]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Kt(this.opts.query)),Y&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},P.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=vt,e.transport=t,this.id&&(e.sid=this.id);const i=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&E.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",E.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let i=0;i<this.writeBuffer.length;i++){const n=this.writeBuffer[i].data;if(n&&(e+=jt(n)),i>0&&e>this._maxPayload)return this.writeBuffer.slice(0,i);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,F(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,e,i){return this._sendPacket("message",t,e,i),this}send(t,e,i){return this._sendPacket("message",t,e,i),this}_sendPacket(t,e,i,n){if(typeof e=="function"&&(n=e,e=void 0),typeof i=="function"&&(n=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const r={type:t,data:e,options:i};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},i=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}_onError(t){if(E.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Y&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=P.indexOf(this._offlineEventListener);i!==-1&&P.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}E.protocol=vt;class le extends E{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),i=!1;E.priorWebsocketSuccess=!1;const n=()=>{i||(e.send([{type:"ping",data:"probe"}]),e.once("packet",m=>{if(!i)if(m.type==="pong"&&m.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;E.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{const C=new Error("probe error");C.transport=e.name,this.emitReserved("upgradeError",C)}}))};function r(){i||(i=!0,u(),e.close(),e=null)}const o=m=>{const C=new Error("probe error: "+m);C.transport=e.name,r(),this.emitReserved("upgradeError",C)};function a(){o("transport closed")}function c(){o("socket closed")}function p(m){e&&m.name!==e.name&&r()}const u=()=>{e.removeListener("open",n),e.removeListener("error",o),e.removeListener("close",a),this.off("close",c),this.off("upgrading",p)};e.once("open",n),e.once("error",o),e.once("close",a),this.once("close",c),this.once("upgrading",p),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let i=0;i<t.length;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}let ue=class extends le{constructor(t,e={}){const i=typeof t=="object"?t:e;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(n=>oe[n]).filter(n=>!!n)),super(t,i)}};function fe(s,t="",e){let i=s;e=e||typeof location<"u"&&location,s==null&&(s=e.protocol+"//"+e.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=e.protocol+s:s=e.host+s),/^(https?|wss?):\/\//.test(s)||(typeof e<"u"?s=e.protocol+"//"+s:s="https://"+s),i=j(s)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(e&&e.port===i.port?"":":"+i.port),i}const pe=typeof ArrayBuffer=="function",me=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,Rt=Object.prototype.toString,ge=typeof Blob=="function"||typeof Blob<"u"&&Rt.call(Blob)==="[object BlobConstructor]",ye=typeof File=="function"||typeof File<"u"&&Rt.call(File)==="[object FileConstructor]";function tt(s){return pe&&(s instanceof ArrayBuffer||me(s))||ge&&s instanceof Blob||ye&&s instanceof File}function D(s,t){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let e=0,i=s.length;e<i;e++)if(D(s[e]))return!0;return!1}if(tt(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return D(s.toJSON(),!0);for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e)&&D(s[e]))return!0;return!1}function _e(s){const t=[],e=s.data,i=s;return i.data=J(e,t),i.attachments=t.length,{packet:i,buffers:t}}function J(s,t){if(!s)return s;if(tt(s)){const e={_placeholder:!0,num:t.length};return t.push(s),e}else if(Array.isArray(s)){const e=new Array(s.length);for(let i=0;i<s.length;i++)e[i]=J(s[i],t);return e}else if(typeof s=="object"&&!(s instanceof Date)){const e={};for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=J(s[i],t));return e}return s}function ve(s,t){return s.data=K(s.data,t),delete s.attachments,s}function K(s,t){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<t.length)return t[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let e=0;e<s.length;e++)s[e]=K(s[e],t);else if(typeof s=="object")for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&(s[e]=K(s[e],t));return s}const be=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],we=5;var h;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(h||(h={}));class Ee{constructor(t){this.replacer=t}encode(t){return(t.type===h.EVENT||t.type===h.ACK)&&D(t)?this.encodeAsBinary({type:t.type===h.EVENT?h.BINARY_EVENT:h.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===h.BINARY_EVENT||t.type===h.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=_e(t),i=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(i),n}}function lt(s){return Object.prototype.toString.call(s)==="[object Object]"}class et extends l{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const i=e.type===h.BINARY_EVENT;i||e.type===h.BINARY_ACK?(e.type=i?h.EVENT:h.ACK,this.reconstructor=new Ce(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(tt(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0;const i={type:Number(t.charAt(0))};if(h[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===h.BINARY_EVENT||i.type===h.BINARY_ACK){const r=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);const o=t.substring(r,e);if(o!=Number(o)||t.charAt(e)!=="-")throw new Error("Illegal attachments");i.attachments=Number(o)}if(t.charAt(e+1)==="/"){const r=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););i.nsp=t.substring(r,e)}else i.nsp="/";const n=t.charAt(e+1);if(n!==""&&Number(n)==n){const r=e+1;for(;++e;){const o=t.charAt(e);if(o==null||Number(o)!=o){--e;break}if(e===t.length)break}i.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(et.isPayloadValid(i.type,r))i.data=r;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case h.CONNECT:return lt(e);case h.DISCONNECT:return e===void 0;case h.CONNECT_ERROR:return typeof e=="string"||lt(e);case h.EVENT:case h.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&be.indexOf(e[0])===-1);case h.ACK:case h.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ce{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=ve(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ke=Object.freeze(Object.defineProperty({__proto__:null,Decoder:et,Encoder:Ee,get PacketType(){return h},protocol:we},Symbol.toStringTag,{value:"Module"}));function _(s,t,e){return s.on(t,e),function(){s.off(t,e)}}const Re=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Tt extends l{constructor(t,e,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[_(t,"open",this.onopen.bind(this)),_(t,"packet",this.onpacket.bind(this)),_(t,"error",this.onerror.bind(this)),_(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var i,n,r;if(Re.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const o={type:h.EVENT,data:e};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){const u=this.ids++,m=e.pop();this._registerAckCallback(u,m),o.id=u}const a=(n=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||n===void 0?void 0:n.writable,c=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,e){var i;const n=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(n===void 0){this.acks[t]=e;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},n),o=(...a)=>{this.io.clearTimeoutFn(r),e.apply(this,a)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise((i,n)=>{const r=(o,a)=>o?n(o):i(a);r.withError=!0,e.push(r),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((n,...r)=>i!==this._queue[0]?void 0:(n!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(n)):(this._queue.shift(),e&&e(null,...r)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:h.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(i=>String(i.id)===t)){const i=this.acks[t];delete this.acks[t],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case h.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case h.EVENT:case h.BINARY_EVENT:this.onevent(t);break;case h.ACK:case h.BINARY_ACK:this.onack(t);break;case h.DISCONNECT:this.ondisconnect();break;case h.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data,this.emitReserved("connect_error",i);break}}onevent(t){const e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const i of e)i.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let i=!1;return function(...n){i||(i=!0,e.packet({type:h.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:h.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const i of e)i.apply(this,t.data)}}}function T(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}T.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*s);s=(Math.floor(t*10)&1)==0?s-e:s+e}return Math.min(s,this.max)|0};T.prototype.reset=function(){this.attempts=0};T.prototype.setMin=function(s){this.ms=s};T.prototype.setMax=function(s){this.max=s};T.prototype.setJitter=function(s){this.jitter=s};class X extends l{constructor(t,e){var i;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,H(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((i=e.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new T({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;const n=e.parser||ke;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new ue(this.uri,this.opts);const e=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const n=_(e,"open",function(){i.onopen(),t&&t()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},o=_(e,"error",r);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{n(),r(new Error("timeout")),e.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(n),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(_(t,"ping",this.onping.bind(this)),_(t,"data",this.ondata.bind(this)),_(t,"error",this.onerror.bind(this)),_(t,"close",this.onclose.bind(this)),_(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){F(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let i=this.nsps[t];return i?this._autoConnect&&!i.active&&i.connect():(i=new Tt(this,t,e),this.nsps[t]=i),i}_destroy(t){const e=Object.keys(this.nsps);for(const i of e)if(this.nsps[i].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let i=0;i<e.length;i++)this.engine.write(e[i],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(n=>{n?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",n)):t.onreconnect()}))},e);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const S={};function q(s,t){typeof s=="object"&&(t=s,s=void 0),t=t||{};const e=fe(s,t.path||"/socket.io"),i=e.source,n=e.id,r=e.path,o=S[n]&&r in S[n].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let c;return a?c=new X(i,t):(S[n]||(S[n]=new X(i,t)),c=S[n]),e.query&&!t.query&&(t.query=e.queryKey),c.socket(e.path,t)}Object.assign(q,{Manager:X,Socket:Tt,io:q,connect:q});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var g=function(){return g=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},g.apply(this,arguments)},Te=function(){function s(t){this.options=t,this.listeners={}}return s.prototype.on=function(t,e){var i=this.listeners[t]||[];this.listeners[t]=i.concat([e])},s.prototype.triggerEvent=function(t,e){var i=this,n=this.listeners[t]||[];n.forEach(function(r){return r({target:i,event:e})})},s}(),R;(function(s){s[s.Add=0]="Add",s[s.Remove=1]="Remove"})(R||(R={}));var Le=function(){function s(){this.notifications=[]}return s.prototype.push=function(t){this.notifications.push(t),this.updateFn(t,R.Add,this.notifications)},s.prototype.splice=function(t,e){var i=this.notifications.splice(t,e)[0];return this.updateFn(i,R.Remove,this.notifications),i},s.prototype.indexOf=function(t){return this.notifications.indexOf(t)},s.prototype.onUpdate=function(t){this.updateFn=t},s}(),w;(function(s){s.Dismiss="dismiss",s.Click="click"})(w||(w={}));var ut={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},Se=function(){function s(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var t=document.createDocumentFragment(),e=this._createHTMLElement({tagName:"div",className:"notyf"});t.appendChild(e),document.body.appendChild(t),this.container=e,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return s.prototype.on=function(t,e){var i;this.events=g(g({},this.events),(i={},i[t]=e,i))},s.prototype.update=function(t,e){e===R.Add?this.addNotification(t):e===R.Remove&&this.removeNotification(t)},s.prototype.removeNotification=function(t){var e=this,i=this._popRenderedNotification(t),n;if(i){n=i.node,n.classList.add("notyf__toast--disappear");var r;n.addEventListener(this.animationEndEventName,r=function(o){o.target===n&&(n.removeEventListener(e.animationEndEventName,r),e.container.removeChild(n))})}},s.prototype.addNotification=function(t){var e=this._renderNotification(t);this.notifications.push({notification:t,node:e}),this._announce(t.options.message||"Notification")},s.prototype._renderNotification=function(t){var e,i=this._buildNotificationCard(t),n=t.options.className;return n&&(e=i.classList).add.apply(e,n.split(" ")),this.container.appendChild(i),i},s.prototype._popRenderedNotification=function(t){for(var e=-1,i=0;i<this.notifications.length&&e<0;i++)this.notifications[i].notification===t&&(e=i);if(e!==-1)return this.notifications.splice(e,1)[0]},s.prototype.getXPosition=function(t){var e;return((e=t==null?void 0:t.position)===null||e===void 0?void 0:e.x)||"right"},s.prototype.getYPosition=function(t){var e;return((e=t==null?void 0:t.position)===null||e===void 0?void 0:e.y)||"bottom"},s.prototype.adjustContainerAlignment=function(t){var e=this.X_POSITION_FLEX_MAP[this.getXPosition(t)],i=this.Y_POSITION_FLEX_MAP[this.getYPosition(t)],n=this.container.style;n.setProperty("justify-content",i),n.setProperty("align-items",e)},s.prototype._buildNotificationCard=function(t){var e=this,i=t.options,n=i.icon;this.adjustContainerAlignment(i);var r=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),a=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),c=this._createHTMLElement({tagName:"div",className:"notyf__message"});c.innerHTML=i.message||"";var p=i.background||i.backgroundColor;if(n){var u=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof n=="string"||n instanceof String)&&(u.innerHTML=new String(n).valueOf()),typeof n=="object"){var m=n.tagName,C=m===void 0?"i":m,Lt=n.className,St=n.text,it=n.color,st=it===void 0?p:it,nt=this._createHTMLElement({tagName:C,className:Lt,text:St});st&&(nt.style.color=st),u.appendChild(nt)}a.appendChild(u)}if(a.appendChild(c),r.appendChild(a),p&&(i.ripple?(o.style.background=p,r.appendChild(o)):r.style.background=p),i.dismissible){var rt=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),ot=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});rt.appendChild(ot),a.appendChild(rt),r.classList.add("notyf__toast--dismissible"),ot.addEventListener("click",function(N){var L,k;(k=(L=e.events)[w.Dismiss])===null||k===void 0||k.call(L,{target:t,event:N}),N.stopPropagation()})}r.addEventListener("click",function(N){var L,k;return(k=(L=e.events)[w.Click])===null||k===void 0?void 0:k.call(L,{target:t,event:N})});var At=this.getYPosition(i)==="top"?"upper":"lower";return r.classList.add("notyf__toast--"+At),r},s.prototype._createHTMLElement=function(t){var e=t.tagName,i=t.className,n=t.text,r=document.createElement(e);return i&&(r.className=i),r.textContent=n||null,r},s.prototype._createA11yContainer=function(){var t=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});t.setAttribute("aria-atomic","true"),t.setAttribute("aria-live","polite"),t.style.border="0",t.style.clip="rect(0 0 0 0)",t.style.height="1px",t.style.margin="-1px",t.style.overflow="hidden",t.style.padding="0",t.style.position="absolute",t.style.width="1px",t.style.outline="0",document.body.appendChild(t),this.a11yContainer=t},s.prototype._announce=function(t){var e=this;this.a11yContainer.textContent="",setTimeout(function(){e.a11yContainer.textContent=t},100)},s.prototype._getAnimationEndEventName=function(){var t=document.createElement("_fake"),e={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},i;for(i in e)if(t.style[i]!==void 0)return e[i];return"animationend"},s}(),Ae=function(){function s(t){var e=this;this.dismiss=this._removeNotification,this.notifications=new Le,this.view=new Se;var i=this.registerTypes(t);this.options=g(g({},ut),t),this.options.types=i,this.notifications.onUpdate(function(n,r){return e.view.update(n,r)}),this.view.on(w.Dismiss,function(n){var r=n.target,o=n.event;e._removeNotification(r),r.triggerEvent(w.Dismiss,o)}),this.view.on(w.Click,function(n){var r=n.target,o=n.event;return r.triggerEvent(w.Click,o)})}return s.prototype.error=function(t){var e=this.normalizeOptions("error",t);return this.open(e)},s.prototype.success=function(t){var e=this.normalizeOptions("success",t);return this.open(e)},s.prototype.open=function(t){var e=this.options.types.find(function(r){var o=r.type;return o===t.type})||{},i=g(g({},e),t);this.assignProps(["ripple","position","dismissible"],i);var n=new Te(i);return this._pushNotification(n),n},s.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},s.prototype.assignProps=function(t,e){var i=this;t.forEach(function(n){e[n]=e[n]==null?i.options[n]:e[n]})},s.prototype._pushNotification=function(t){var e=this;this.notifications.push(t);var i=t.options.duration!==void 0?t.options.duration:this.options.duration;i&&setTimeout(function(){return e._removeNotification(t)},i)},s.prototype._removeNotification=function(t){var e=this.notifications.indexOf(t);e!==-1&&this.notifications.splice(e,1)},s.prototype.normalizeOptions=function(t,e){var i={type:t};return typeof e=="string"?i.message=e:typeof e=="object"&&(i=g(g({},i),e)),i},s.prototype.registerTypes=function(t){var e=(t&&t.types||[]).slice(),i=ut.types.map(function(n){var r=-1;e.forEach(function(a,c){a.type===n.type&&(r=c)});var o=r!==-1?e.splice(r,1)[0]:{};return g(g({},n),o)});return i.concat(e)},s}();class Ne{constructor(){d(this,"_room");d(this,"_user");d(this,"_isMobile");d(this,"_isLeftSidebarOpen");d(this,"_isRightSidebarOpen");d(this,"_isRoomLoaded");this._room={id:"",name:"",members:[],messages:[]},this._user=null,this._isMobile=window.innerWidth<1024,this._isLeftSidebarOpen=!1,this._isRightSidebarOpen=!1,this._isRoomLoaded=!1}get room(){return this._room}get user(){return this._user}get isMobile(){return this._isMobile}get isLeftSidebarOpen(){return this._isLeftSidebarOpen}get isRightSidebarOpen(){return this._isRightSidebarOpen}get isRoomLoaded(){return this._isRoomLoaded}setRoom(t){this._room={...this._room,...t}}setUser(t){this._user=t}setRoomMembers(t){this._room.members=[...new Map(t.map(e=>[e.id,e])).values()].sort((e,i)=>e.joinedAt-i.joinedAt)}addRoomMember(t){this.setRoomMembers([...this._room.members,t])}updateRoomMember(t,e){this._room.members=this._room.members.map(i=>i.id===t?{...i,...e}:i)}getMember(t){return this._room.members.find(e=>e.id===t)}addMessage(t){this._room.messages.push(t)}setRoomLoaded(t){this._isRoomLoaded=t}setMobile(t){this._isMobile=t}toggleLeftSidebar(){this._isLeftSidebarOpen=!this._isLeftSidebarOpen}toggleRightSidebar(){this._isRightSidebarOpen=!this._isRightSidebarOpen}setMobileLeftSidebarOpen(t){this._isLeftSidebarOpen=t}setMobileRightSidebarOpen(t){this._isRightSidebarOpen=t}}const B=["from-blue-500 to-purple-500","from-green-500 to-teal-500","from-yellow-500 to-orange-500","from-pink-500 to-rose-500","from-indigo-500 to-blue-500","from-red-500 to-pink-500","from-teal-500 to-cyan-500","from-purple-500 to-indigo-500","from-orange-500 to-red-500","from-cyan-500 to-blue-500"];class xe{constructor(t,e){d(this,"store");d(this,"notyf");this.store=t,this.notyf=e}initialize(){this.initializeRoomUI(),this.updateUsersList(),this.updateChatMessages()}initializeRoomUI(){this.removeLoadingOverlay();const t=this.getUIElements();this.store.setMobile(window.innerWidth<1024),this.updateLayout(),window.addEventListener("resize",()=>{this.store.setMobile(window.innerWidth<1024),this.updateLayout()}),t.toggleLeft.addEventListener("click",()=>{this.store.toggleLeftSidebar(),this.updateLayout()}),t.toggleRight.addEventListener("click",()=>{this.store.toggleRightSidebar(),this.updateLayout()}),t.floatingLeftToggle.addEventListener("click",()=>{this.store.toggleLeftSidebar(),this.updateLayout()}),t.floatingRightToggle.addEventListener("click",()=>{this.store.toggleRightSidebar(),this.updateLayout()})}getUIElements(){return{leftSidebar:document.getElementById("leftSidebar"),rightSidebar:document.getElementById("rightSidebar"),toggleLeft:document.getElementById("toggleLeft"),toggleRight:document.getElementById("toggleRight"),floatingLeftToggle:document.getElementById("floatingLeftToggle"),floatingRightToggle:document.getElementById("floatingRightToggle"),roomNameText:document.getElementById("roomName"),roomMembersCount:document.getElementById("roomMembersCount"),roomUsersList:document.getElementById("roomUsersList"),chatMessages:document.getElementById("chatMessages"),shareBtn:document.getElementById("shareBtn"),endCallBtn:document.getElementById("endCallBtn"),chatForm:document.getElementById("chatForm"),chatInput:document.getElementById("chatInput"),muteBtn:document.getElementById("muteBtn"),joinAudioChat:document.getElementById("joinAudioChat"),joinAudioChatHoverText:document.getElementById("joinAudioChatHoverText")}}updateLayout(){const t=this.getUIElements(),{isMobile:e,isLeftSidebarOpen:i,isRightSidebarOpen:n}=this.store;e?this.handleMobileLayout(t,i,n):this.handleDesktopLayout(t,i,n)}handleMobileLayout(t,e,i){if(e?(t.leftSidebar.classList.add("sidebar-mobile"),t.leftSidebar.classList.remove("open"),t.floatingLeftToggle.classList.remove("hidden")):(t.leftSidebar.classList.add("sidebar-mobile","open"),t.floatingLeftToggle.classList.add("hidden")),i?(t.rightSidebar.classList.add("sidebar-mobile-right"),t.rightSidebar.classList.remove("open"),t.floatingRightToggle.classList.remove("hidden")):(t.rightSidebar.classList.add("sidebar-mobile-right","open"),t.floatingRightToggle.classList.add("hidden")),!e||!i){if(!document.getElementById("mobileOverlay")){const n=document.createElement("div");n.id="mobileOverlay",n.className="fixed inset-0 bg-black/50 z-30 lg:hidden",n.addEventListener("click",()=>{this.store.setMobileLeftSidebarOpen(!0),this.store.setMobileRightSidebarOpen(!0),this.updateLayout()}),document.body.appendChild(n)}}else{const n=document.getElementById("mobileOverlay");n&&n.remove()}}handleDesktopLayout(t,e,i){t.leftSidebar.classList.remove("sidebar-mobile","sidebar-mobile-right","open"),t.rightSidebar.classList.remove("sidebar-mobile","sidebar-mobile-right","open"),e?(t.leftSidebar.style.width="0px",t.leftSidebar.style.minWidth="0px",t.leftSidebar.style.overflow="hidden",t.floatingLeftToggle.classList.remove("hidden")):(t.leftSidebar.style.width="320px",t.leftSidebar.style.minWidth="320px",t.leftSidebar.style.overflow="visible",t.floatingLeftToggle.classList.add("hidden")),i?(t.rightSidebar.style.width="0px",t.rightSidebar.style.minWidth="0px",t.rightSidebar.style.overflow="hidden",t.floatingRightToggle.classList.remove("hidden")):(t.rightSidebar.style.width="320px",t.rightSidebar.style.minWidth="320px",t.rightSidebar.style.overflow="visible",t.floatingRightToggle.classList.add("hidden"));const n=document.getElementById("mobileOverlay");n&&n.remove()}updateUsersList(){const t=this.getUIElements();!t.roomNameText||!t.roomMembersCount||!t.roomUsersList||(t.roomNameText.textContent=this.store.room.name,t.roomMembersCount.textContent=`${this.store.room.members.length} participant${this.store.room.members.length===1?"":"s"}`,t.roomUsersList.innerHTML=this.store.room.members.map((e,i)=>this.createUserListItem(e,i)).join(""))}createUserListItem(t,e){const i=B[e%B.length],n=t.socketId.length>0,r=t.isMuted,o=t.isJoinedInAudioChat;return`
      <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-700/30 transition-colors">
        <div class="relative">
          <div class="w-8 h-8 rounded-full bg-gradient-to-r ${i} flex items-center justify-center text-white font-medium">
            ${t.userName[0]}
          </div>
          <div class="absolute -bottom-1 -right-1 w-3 h-3 ${n?"bg-green-500":"bg-gray-500"} border-2 border-gray-800 rounded-full"></div>
        </div>
        <div class="flex-1">
          <p class="text-sm font-medium">${t.userName}</p>
          <p class="text-xs text-gray-400">${t.isHost?"Host":""}</p>
        </div>
        ${n&&o?`
        <div class="flex items-center space-x-2">
          ${r?`<svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                  <line x1="17" y1="7" x2="7" y2="17" stroke="currentColor" stroke-width="2"></line>
                </svg>`:`<div class="audio-bars">
                  <div class="audio-bar" style="height: 8px"></div>
                  <div class="audio-bar" style="height: 12px"></div>
                  <div class="audio-bar" style="height: 6px"></div>
                  <div class="audio-bar" style="height: 10px"></div>
                </div>`}
        </div>`:""}
      </div>
    `}updateChatMessages(){const t=document.getElementById("chatMessages");if(t){if(!this.store.room.messages.length){t.innerHTML=`
        <div class="flex items-center justify-center h-full">
          <p class="text-gray-500">No messages yet</p>
        </div>
      `;return}t.innerHTML=this.store.room.messages.map(e=>this.createMessageElement(e)).join(""),t.scrollTop=t.scrollHeight}}createMessageElement(t){const e=this.store.room.members.findIndex(r=>r.id===t.senderId),i=this.store.room.members[e];return`
      <div class="chat-message">
        <div class="flex items-start space-x-3">
          <div class="relative">
            <div class="w-8 h-8 rounded-full bg-gradient-to-r ${B[e%B.length]} flex items-center justify-center text-white font-medium">
              ${i==null?void 0:i.userName[0]}
            </div>
          </div>
          <div>
            <div class="flex items-center space-x-2">
              <span class="text-sm font-medium text-blue-400">${i==null?void 0:i.userName}</span>
              <span class="text-xs text-gray-500">${this.formatMessageTimestamp(t.createdAt)}</span>
            </div>
            <p class="text-sm text-gray-300 mt-1">${t.content}</p>
          </div>
        </div>
      </div>
    `}formatMessageTimestamp(t){const e=new Date(t),n=Math.abs(new Date().getTime()-e.getTime()),r=Math.floor(n/(1e3*60*60*24)),o=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0"),c=`${o}:${a}`;if(r===0)return`Today at ${c}`;if(r===1)return`Yesterday at ${c}`;{const p=(e.getMonth()+1).toString().padStart(2,"0"),u=e.getDate().toString().padStart(2,"0"),m=e.getFullYear();return`${p}/${u}/${m} at ${c}`}}updateMuteButton(t){const i=this.getUIElements().muteBtn;i&&(t?i.innerHTML=`
        <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
          <line x1="17" y1="7" x2="7" y2="17" stroke="currentColor" stroke-width="2"></line>
        </svg>`:i.innerHTML=`
        <div class="audio-bars">
          <div class="audio-bar" style="height: 8px"></div>
          <div class="audio-bar" style="height: 12px"></div>
          <div class="audio-bar" style="height: 6px"></div>
          <div class="audio-bar" style="height: 10px"></div>
        </div>`)}audioChatControlButton(t){const e=this.getUIElements(),i=e.joinAudioChat,n=e.joinAudioChatHoverText;!i||!n||(t?(n.textContent="Leave Audio Chat",i.classList.add("bg-red-700","hover:bg-red-600"),i.classList.remove("bg-green-700","hover:bg-green-600")):(n.textContent="Join Audio Chat",i.classList.add("bg-green-700","hover:bg-green-600"),i.classList.remove("bg-red-700","hover:bg-red-600")))}showNotification(t,e){e==="success"?this.notyf.success({message:t,duration:2e3,dismissible:!0,position:{x:"center",y:"top"}}):e==="info"?this.notyf.success({message:t,duration:2e3,dismissible:!0,position:{x:"center",y:"top"},type:"custom",className:"bg-blue-500 text-white"}):e==="error"?this.notyf.error({message:t,duration:3e3,dismissible:!0,position:{x:"center",y:"top"}}):e==="warning"&&this.notyf.success({message:t,duration:3e3,dismissible:!0,position:{x:"center",y:"top"},type:"custom",className:"bg-orange-500 text-white"})}showError(t){this.notyf.error({message:t,duration:3e3,dismissible:!0,position:{x:"center",y:"top"}})}showLoadingError(t,e){const i=document.getElementById("error-text"),n=document.getElementById("error-description"),r=document.getElementById("loading-text");i&&n&&r&&(r.textContent="",i.textContent=t,n.textContent=e)}updateLoadingText(t){const e=document.getElementById("loading-text");e&&(e.textContent=t)}removeLoadingOverlay(){const t=document.getElementById("loading-overlay");t&&t.remove()}}class Oe{constructor(t,e,i,n){d(this,"peerConnections",new Map);d(this,"localStream",null);d(this,"socket");d(this,"store");d(this,"uiManager");d(this,"isMuted",!1);this.socket=t,this.store=e,this.uiManager=i,this.setupSocketListeners()}setupSocketListeners(){this.socket.on(f.RECEIVE_WEBRTC_OFFER,async({from:t,offer:e})=>{console.log(`Received WebRTC offer from ${t}`);const i=this.store.room.members.find(o=>o.socketId===t);if(!i){console.error("Connection not found");return}const n=await this.createPeerConnection(i.id);await n.setRemoteDescription(e);const r=await n.createAnswer();await n.setLocalDescription(r),console.log(`Sending WebRTC answer to ${i.id}`),this.socket.emit(f.SEND_WEBRTC_ANSWER,{to:i.id,answer:r,roomId:this.store.room.id})}),this.socket.on(f.RECEIVE_WEBRTC_ANSWER,async({from:t,answer:e})=>{console.log(`Received WebRTC answer from ${t}`);const i=this.store.room.members.find(r=>r.socketId===t);if(!i){console.error("Connection not found");return}const n=this.peerConnections.get(i.id);n&&await n.setRemoteDescription(e)}),this.socket.on(f.RECEIVE_WEBRTC_ICE_CANDIDATE,async({from:t,candidate:e})=>{console.log(`Received ICE candidate from ${t}`);const i=this.store.room.members.find(r=>r.socketId===t);if(!i){console.error("Connection not found");return}const n=this.peerConnections.get(i.id);n&&await n.addIceCandidate(e)}),this.socket.on(f.USER_JOINED_AUDIO_CHAT,({userId:t})=>{console.log(`User ${t} joined audio chat`);const e=this.store.room.members.find(i=>i.id===t);if(!e){console.error("Connection not found");return}this.store.room.members.forEach(i=>{i.id===t&&(i.isJoinedInAudioChat=!0)}),this.uiManager.showNotification(e.userName+" joined audio chat","info"),this.uiManager.updateUsersList()}),this.socket.on(f.USER_LEFT_AUDIO_CHAT,({userId:t})=>{console.log(`User ${t} left audio chat`);const e=this.store.room.members.find(i=>i.id===t);if(!e){console.error("Connection not found");return}this.store.room.members.forEach(i=>{i.id===t&&(i.isJoinedInAudioChat=!1)}),this.uiManager.showNotification(`User ${e.userName} left audio chat`,"warning"),this.uiManager.updateUsersList()})}async startAudioChat(){try{this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.store.room.members.forEach(t=>{t.socketId&&t.socketId!==this.socket.id&&this.createPeerConnectionAndSendOffer(t.id)}),this.store.room.members.forEach(t=>{t.id===this.store.user.id&&(t.isJoinedInAudioChat=!0)}),this.uiManager.updateUsersList(),this.uiManager.audioChatControlButton(!0),this.uiManager.showNotification("Connected to audio chat","success"),this.socket.emit(f.JOIN_AUDIO_CHAT,{roomId:this.store.room.id})}catch(t){throw console.error("Error starting audio chat:",t),new Error("Failed to start audio chat: "+(t instanceof Error?t.message:"An unknown error occurred"))}}async createPeerConnectionAndSendOffer(t){const e=await this.createPeerConnection(t),i=await e.createOffer();await e.setLocalDescription(i),console.log(`Sending WebRTC offer to ${t}`),this.socket.emit(f.SEND_WEBRTC_OFFER,{to:t,offer:i,roomId:this.store.room.id})}async createPeerConnection(t){const e={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},i=new RTCPeerConnection(e);return this.peerConnections.set(t,i),this.localStream&&this.localStream.getTracks().forEach(n=>{i.addTrack(n,this.localStream)}),this.bindPeerConnectionListeners(i,t),i}bindPeerConnectionListeners(t,e){t.ontrack=i=>{const n=i.streams[0];this.handleRemoteStream(e,n)},t.onicecandidate=i=>{i!=null&&i.candidate&&(console.log(`Sending ICE candidate to ${e}`),this.socket.emit(f.SEND_WEBRTC_ICE_CANDIDATE,{to:e,candidate:i.candidate,roomId:this.store.room.id}))}}handleRemoteStream(t,e){const i=new Audio;i.srcObject=e,i.autoplay=!0,console.log("received remote stream from",t,e)}stopAudioChat(){var t;(t=this.localStream)==null||t.getTracks().forEach(e=>e.stop()),this.localStream=null,this.peerConnections.forEach(e=>e.close()),this.peerConnections.clear(),this.store.room.members.forEach(e=>{e.id===this.store.user.id&&(e.isJoinedInAudioChat=!1)}),this.uiManager.updateUsersList(),this.uiManager.audioChatControlButton(!1),this.uiManager.showNotification("Disconnected from audio chat","warning"),this.socket.emit(f.LEAVE_AUDIO_CHAT,{roomId:this.store.room.id})}toggleMute(){if(!this.localStream)return this.uiManager.showNotification("You are not connected to any audio channel","warning"),!1;const t=this.localStream.getAudioTracks();return t.length===0?(this.uiManager.showNotification("No audio tracks found","warning"),!1):(this.isMuted=!this.isMuted,t.forEach(e=>{e.enabled=!this.isMuted}),this.store.room.members=this.store.room.members.map(e=>e.id===this.store.user.id?{...e,isMuted:this.isMuted}:e),this.uiManager.updateUsersList(),this.socket.emit(f.AUDIO_STATUS_CHANGED,{roomId:this.store.room.id,userId:this.store.user.id,isMuted:this.isMuted}),this.uiManager.showNotification(this.isMuted?"You are now muted":"You are now unmuted","info"),this.isMuted)}}class ft{static getCachedRoomId(){return localStorage.getItem(x.ROOM_ID)}static setCachedRoomId(t){localStorage.setItem(x.ROOM_ID,t)}static getCachedUserId(){return localStorage.getItem(x.USER_ID)}static setCachedUserId(t){localStorage.setItem(x.USER_ID,t)}}class Me{constructor(){d(this,"socket",null);d(this,"webRTCManager",null);d(this,"uiManager");d(this,"store");d(this,"notyf");this.notyf=new Ae,this.store=new Ne,this.uiManager=new xe(this.store,this.notyf)}async initialize(){try{this.uiManager.updateLoadingText("Loading room..."),await this.loadRoom(),this.uiManager.updateLoadingText("Connecting to room..."),this.socket=await this.connectToRoom(),this.uiManager.initialize(),this.store.setRoomLoaded(!0),this.webRTCManager=new Oe(this.socket,this.store,this.uiManager,this.notyf),this.bindSocketListeners(),this.bindUIHandlers(),await this.webRTCManager.startAudioChat(),this.bindWebRTCControls()}catch(t){this.handleInitializationError(t)}}async loadRoom(){const t=new URLSearchParams(window.location.search),e=t.get(O.ROOM_ID),i=t.get(O.USER_ID);if(!e||!i)throw new Error("roomId or userId is missing in the URL");const n=await Ot(async()=>this.fetchRoomData(e));this.store.setRoom({...this.store.room,name:n.name,id:e,members:n.users,messages:n.messages}),ft.setCachedRoomId(e),ft.setCachedUserId(i)}async fetchRoomData(t){return await(await fetch(`https://streamlocal.onrender.com/api/room/${t}`)).json()}async connectToRoom(){return new Promise((t,e)=>{const i=new URLSearchParams(window.location.search),n=i.get(O.ROOM_ID),r=i.get(O.USER_ID);if(!n||!r){e(new Error("roomId or userId is missing in the URL"));return}const o=q("https://streamlocal.onrender.com/");o.on("connect",()=>{o.emit(f.JOIN_ROOM,{roomId:n,userId:r},a=>{this.store.setUser(a),this.store.setRoomMembers([...this.store.room.members,a]),t(o)})})})}bindSocketListeners(){this.socket&&(this.socket.on(f.ERROR,t=>{this.uiManager.showNotification(t??"Failed to perform last action","error")}),this.socket.on(f.USER_JOINED,t=>{this.store.addRoomMember(t),this.uiManager.updateUsersList(),this.uiManager.showNotification(`${t.userName} joined`,"info")}),this.socket.on(f.USER_LEFT,t=>{const e=this.store.getMember(t);e&&(this.store.updateRoomMember(t,{socketId:""}),this.uiManager.updateUsersList(),this.uiManager.showNotification(`${e.userName} left`,"warning"))}),this.socket.on(f.RECEIVE_MESSAGE,t=>{this.store.addMessage(t),this.uiManager.updateChatMessages()}),this.socket.on(f.USER_AUDIO_STATUS_CHANGED,({userId:t,isMuted:e})=>{this.store.updateRoomMember(t,{isMuted:e}),this.uiManager.updateUsersList()}))}bindUIHandlers(){const t=this.uiManager.getUIElements();t.chatForm.addEventListener("submit",e=>{var n;e.preventDefault();const i=t.chatInput.value;!i||!this.socket||(this.socket.emit(f.SEND_MESSAGE,{roomId:this.store.room.id,userId:(n=this.store.user)==null?void 0:n.id,content:i},r=>{this.store.addMessage(r),this.uiManager.updateChatMessages()}),t.chatInput.value="")}),t.shareBtn.addEventListener("click",()=>this.handleShareInviteLink()),t.endCallBtn.addEventListener("click",()=>this.handleLeaveRoom()),t.joinAudioChat.addEventListener("click",()=>{var i,n,r;if((i=this.store.room.members.find(o=>{var a;return o.id===((a=this.store.user)==null?void 0:a.id)}))==null?void 0:i.isJoinedInAudioChat){(n=this.webRTCManager)==null||n.stopAudioChat();return}(r=this.webRTCManager)==null||r.startAudioChat()})}handleShareInviteLink(){const t=new URL(window.location.href),e=t.searchParams.get("id"),n=`${t.origin.replace("/room.html","")}?id=${e}`;navigator.clipboard.writeText(n).then(()=>{this.uiManager.showNotification("Invite link copied to clipboard!","success")}).catch(r=>{console.error("Failed to copy link:",r),this.uiManager.showNotification("Failed to copy link to clipboard","error")})}handleLeaveRoom(){window.location.href="/"}bindWebRTCControls(){const t=document.getElementById("muteBtn");!t||!this.webRTCManager||t.addEventListener("click",()=>{var i;const e=(i=this.webRTCManager)==null?void 0:i.toggleMute();this.uiManager.updateMuteButton(e??!1)})}handleInitializationError(t){console.error(t);const e=t instanceof Error?t.message:"An unknown error occurred";this.store.isRoomLoaded?this.uiManager.showNotification(e,"error"):this.uiManager.showLoadingError("Failed to load room. Please try again.",e)}}document.addEventListener("DOMContentLoaded",()=>{new Me().initialize()});
